---
title: crosstalk test
author: ''
date: '2020-02-24'
slug: crosstalk-test
categories: []
tags:
  - crosstalk
description: ''
draft: true

---



<div id="heading-1" class="section level1">
<h1>heading 1</h1>
<div id="heading-1.1" class="section level2">
<h2>heading 1.1</h2>
</div>
</div>
<div id="heading-2" class="section level1">
<h1>heading 2</h1>
<pre class="r"><code>unstrap &lt;- function(x) {
  attr(x, &quot;html_dependencies&quot;) &lt;-
    Filter(
      function(dependency) {dependency$name != &quot;bootstrap&quot;},
      attr(x, &quot;html_dependencies&quot;)
    )
  x
}</code></pre>
<pre class="r"><code>df_main &lt;- structure(list(pair_indicator = c(
  &quot;902021-902071&quot;, &quot;902031-902071&quot;,
  &quot;902031-902091&quot;, &quot;902081-902101&quot;, &quot;902081-902241&quot;, &quot;902101-902241&quot;
), school_1_lat = c(
  48.2149026, 48.2221631, 48.2221631, 48.2205238,
  48.2205238, 48.223532
), school_2_lat = c(
  48.2186668, 48.2186668,
  48.22407, 48.223532, 48.2231059, 48.2231059
), school_1_long = c(
  16.3876769,
  16.3848147, 16.3848147, 16.4049726, 16.4049726, 16.402895
), school_2_long = c(
  16.3853998,
  16.3853998, 16.3847968, 16.402895, 16.4063758, 16.4063758
), distance = c(
  475.2529684845,
  379.0377208616, 203.6641400739, 395.8339316511, 316.9061306841,
  390.1434258679
), diff_factor = c(
  1.96024763767, 2.27963849016,
  2.27354570637, 1.3, 1.57575757576, 1.21212121212
)), class = c(
  &quot;tbl_df&quot;,
  &quot;tbl&quot;, &quot;data.frame&quot;
), row.names = c(NA, -6L))


df_main &lt;- readr::read_csv2(here(&quot;blog_data&quot;, &quot;Vienna_primary_schools&quot;,
                                        &quot;shared_df_main.csv&quot;))</code></pre>
<pre><code>## Using &#39;,&#39; as decimal and &#39;.&#39; as grouping mark. Use read_delim() for more control.</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   pair_indicator = col_character(),
##   address1 = col_character(),
##   address2 = col_character(),
##   school_1_erhalter = col_character(),
##   school_2_erhalter = col_character(),
##   school_erhalter_indicator = col_character(),
##   erhalter_type = col_character(),
##   tooltip = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="r"><code>library(crosstalk)
shared_df_main &lt;- SharedData$new(df_main)


# &gt; scatter plotly --------------------------------------------------------
library(plotly)

plot_distance_diff &lt;-  
  plot_ly(
    data=shared_df_main,
    mode=&#39;markers&#39;,
    type=&quot;scatter&quot;
    ) %&gt;% 
  add_trace(
    #text=~tooltip,
    marker=list(color=&#39;green&#39;),
    x=~distance,
    y=~diff_factor,
    showlegend=F
  )
    

# &gt; map -------------------------------------------------------------------

Sys.setenv(&#39;MAPBOX_TOKEN&#39; = &#39;pk.eyJ1Ijoiem9vd2FsayIsImEiOiJjazFjMW52NWIwZDVjM21scmE1Y296MnUxIn0.ZXSu71B2VjyBwlUldNUtLg&#39;)

library(plotly)

cross_map2 &lt;- plot_mapbox(
  data=shared_df_main) %&gt;%
  add_markers(
    y = ~school_1_lat,
    x = ~school_1_long,
    color = &quot;#FF0000&quot;
    #text = ~address1
    ) %&gt;%
  add_markers(
    y = ~school_2_lat,
    x = ~school_2_long,
    color = &quot;#FF0000&quot;
    #text = ~address2
   ) %&gt;%
  layout(
    mapbox = list(style = &#39;light&#39;,
                  zoom = 10,
                  center = list(lat = 48.21, 
                                lon = 16.3720798)
                  ),
    showlegend=FALSE#,
    #margin=0
    )


 
# &gt; combine graphs -----------------------------------------------------------

d &lt;- crosstalk::bscols(
    plot_distance_diff, 
  cross_map2)

attr(d, &quot;html_dependencies&quot;)</code></pre>
<pre><code>## [[1]]
## List of 10
##  $ name      : chr &quot;jquery&quot;
##  $ version   : chr &quot;1.11.3&quot;
##  $ src       :List of 1
##   ..$ file: chr &quot;C:/Users/Roland/Documents/R/win-library/3.6/crosstalk/lib/jquery&quot;
##  $ meta      : NULL
##  $ script    : chr &quot;jquery.min.js&quot;
##  $ stylesheet: NULL
##  $ head      : NULL
##  $ attachment: NULL
##  $ package   : NULL
##  $ all_files : logi TRUE
##  - attr(*, &quot;class&quot;)= chr &quot;html_dependency&quot;
## 
## [[2]]
## List of 10
##  $ name      : chr &quot;bootstrap&quot;
##  $ version   : chr &quot;3.3.2&quot;
##  $ src       :List of 1
##   ..$ file: chr &quot;C:/Users/Roland/Documents/R/win-library/3.6/crosstalk/lib/bootstrap&quot;
##  $ meta      :List of 1
##   ..$ viewport: chr &quot;width=device-width, initial-scale=1&quot;
##  $ script    : chr &quot;js/bootstrap.min.js&quot;
##  $ stylesheet: chr &quot;css/bootstrap.min.css&quot;
##  $ head      : NULL
##  $ attachment: NULL
##  $ package   : NULL
##  $ all_files : logi TRUE
##  - attr(*, &quot;class&quot;)= chr &quot;html_dependency&quot;</code></pre>
<pre class="r"><code>d &lt;- unstrap(d)</code></pre>
</div>
