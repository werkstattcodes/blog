---
title: 'Austrian Parliament: MPs transparency and conflict of interest report - Bundesrat'
author: rs
date: '2020-07-22'
slug: austrian-parliament-mps-transparency-and-conflict-of-interest-report-bundesrat
categories: []
draft: true
tags:
  - Austria
  - OCR
description: ''
---



<div id="context" class="section level1">
<h1>Context</h1>
<p>This is a follow-up on my previous post on the transprancey report by Austria’s Parliament. While I limited</p>
</div>
<div id="steps-in-r" class="section level1">
<h1>Steps in R</h1>
<div id="setup" class="section level2">
<h2>Setup</h2>
<details closed>
<p><summary>Code: Load packages</summary></p>
<pre class="r"><code>library(tidyverse)
library(here)
library(extrafont)
loadfonts(device = &quot;win&quot;, quiet = T)
library(hrbrthemes)
hrbrthemes::update_geom_font_defaults(family = &quot;Roboto Condensed&quot;,
                                      size=3)
library(scales)
library(knitr)
library(paletteer)
library(ggtext)
library(glue)
library(gt)
library(DT)
library(pdftools)
library(lemon)
library(gender)
library(ggiraph)</code></pre>
</details>
<details closed>
<p><summary>Code: Define rmarkdown options</summary></p>
<pre class="r"><code>knit_hooks$set(wrap = function(before, options, envir) {
  if (before) {
    paste0(&quot;&lt;&quot;, options$wrap, &quot;&gt;&quot;)
  } else {
    paste0(&quot;&lt;/&quot;, options$wrap, &quot;&gt;&quot;)
  }
})

knitr::opts_chunk$set(
  echo = TRUE,
  fig.align = &quot;left&quot;,
  # fig.height = 5,
  # fig.width = 7,
  out.width = &quot;100%&quot;,
  message = FALSE,
  warning = FALSE,
  dpi = 300
)

options(width = 180, dplyr.width = 150)</code></pre>
</details>
<details closed>
<p><summary>Code: Define plot theme</summary></p>
<pre class="r"><code>theme_post &lt;- function() {
  hrbrthemes::theme_ipsum_rc() +
    theme(
      plot.margin = margin(l = 0, unit = &quot;cm&quot;),
      plot.title = element_markdown(
        color = &quot;grey20&quot;,
        face = &quot;bold&quot;,
        margin = margin(l = 0, unit = &quot;cm&quot;),
        size = 13
      ),
      plot.title.position = &quot;plot&quot;,
      plot.subtitle = element_text(
        color = &quot;grey50&quot;,
        margin = margin(t = 0.2, b = 0.3, unit = &quot;cm&quot;),
        size = 11
      ),
      plot.caption = element_text(
        color = &quot;grey50&quot;,
        size = 8,
        hjust = c(0)
      ),
      plot.caption.position = &quot;panel&quot;,
      axis.title.x = element_text(angle = 0,
                                         color=&quot;grey50&quot;,
                                         hjust=1),
      axis.text.x = element_text(size = 9, 
                                 color = &quot;grey50&quot;),
      axis.title.y = element_blank(),
      axis.text.y = element_text(size = 9,
                                 color=&quot;grey50&quot;),
      panel.grid.minor.x = element_blank(),
      panel.grid.major.x = element_blank(),
      panel.grid.minor.y = element_blank(),
      panel.spacing = unit(0.25, &quot;cm&quot;),
      panel.spacing.y = unit(0.25, &quot;cm&quot;),
      strip.text = element_text(
        angle = 0,
        size = 9,
        vjust = 1,
        face = &quot;bold&quot;
      ),
      legend.title = element_text(
        color = &quot;grey30&quot;,
        face = &quot;bold&quot;,
        vjust = 1,
        size = 7
      ),
      legend.text = element_text(
        size = 7,
        color = &quot;grey30&quot;
      ),
      legend.justification = &quot;left&quot;,
      legend.box = &quot;horizontal&quot;, # arrangement of multiple legends
      legend.direction = &quot;vertical&quot;,
      legend.margin = margin(l = 0, t = 0, unit = &quot;cm&quot;),
      legend.spacing.y = unit(0.07, units = &quot;cm&quot;),
      legend.text.align = 0,
      legend.box.just = &quot;top&quot;,
      legend.key.height = unit(0.2, &quot;line&quot;),
      legend.key.width = unit(0.5, &quot;line&quot;),
      text = element_text(size = 5)
    )
}

my_caption=c(&quot;data: Austrian Parliament, Liste gemäß § 9 Bezügebegrenzungs-BVG, 2020. \nanalysis: Roland Schmidt | @zoowalk | https://werk.statt.codes&quot;)</code></pre>
</details>
</div>
<div id="data-extraction" class="section level2">
<h2>Data extraction</h2>
<details open>
<p><summary>Code: Extract text from pdfs </summary></p>
<pre class="r"><code>my_path &lt;- here::here(&quot;blog_data&quot;, &quot;MP_activities&quot;, &quot;BezBegrBVGPar9-BR.pdf&quot;)

df_data &lt;- pdftools::pdf_data(pdf=my_path)

df1 &lt;- df_data %&gt;% 
  map_dfr(., bind_rows, .id=&quot;id&quot;) %&gt;% 
  mutate(id=as.numeric(id)) 

df_names &lt;- df1 %&gt;% 
  filter(y==99) %&gt;% 
  group_by(id) %&gt;% 
  summarize(name=paste0(text, collapse=&quot; &quot;))

df2 &lt;- df1 %&gt;% 
  group_by(id) %&gt;% 
  mutate(line_diff = y - dplyr::lag(y, default = 0)) %&gt;%
    mutate(row_jump = case_when(
      line_diff &gt; 11 ~ 1,
      TRUE ~ 0
    )) %&gt;%
  mutate(row_indicator = cumsum(row_jump)) %&gt;%
  group_by(id, row_indicator) %&gt;% 
  summarise(text=paste0(text, collapse=&quot; &quot;)) 
  
df_income &lt;- df2 %&gt;% 
  filter(str_detect(text, regex(&quot;2019\\:&quot;))==T) %&gt;% 
  mutate(income=str_extract(text, &quot;(?&lt;=2019:.?)\\S&quot;)) %&gt;% 
  select(-row_indicator, -text)

df_all &lt;- df_names %&gt;% 
  left_join(., df_income,
            by=&quot;id&quot;) %&gt;% 
      mutate(name_clean=name %&gt;% str_remove(., regex(&quot;,.*$&quot;)) %&gt;% 
           str_remove_all(., regex(&quot;\\S*\\.&quot;)) %&gt;% 
           str_remove_all(., regex(&quot;\\(.*\\)&quot;)) %&gt;% 
           str_trim()) %&gt;% 
    mutate(first_name=str_extract(name_clean, regex(&quot;^\\S*&quot;))) 

df_all &lt;- df_all %&gt;%
  mutate(name_gender=map(first_name, possibly(gender,  otherwise=&quot;missing&quot;)))  

df_all &lt;- df_all %&gt;% 
  mutate(gender=map_chr(name_gender, purrr::pluck, &quot;gender&quot;, .default=NA)) %&gt;% 
  select(-name_gender)</code></pre>
</details>
<pre class="r"><code>library(rvest)
#link from button &#39;alle anzeigen&#39;
link_br_all &lt;- &quot;https://www.parlament.gv.at/WWER/BR/MITGL/index.shtml?xdocumentUri=&amp;GP=ALLE&amp;BL=ALLE_BL&amp;STEP=1070&amp;feldRnr=3&amp;FR=ALLE&amp;M=M&amp;ascDesc=ASC&amp;NRBR=BR&amp;FBEZ=FW_007&amp;view=&amp;jsMode=&amp;LISTE=&amp;requestId=870460213E&amp;W=W&amp;letter=&amp;WP=ALLE&amp;R_WF=WP&amp;listeId=7&amp;filterJq=&quot;

df_table &lt;- link_br_all %&gt;%
  read_html() %&gt;% 
  html_nodes(&quot;#filterListeFW_007 &gt; table&quot;) %&gt;% 
  html_table() %&gt;% .[[1]]

df_br &lt;- df_table %&gt;% 
  janitor::clean_names() %&gt;% 
  mutate(name=str_remove_all(name, &quot;Name&quot;) %&gt;% str_trim() %&gt;% str_squish(),
         wahlpartei=str_remove_all(wahlpartei, &quot;Wahlpartei&quot;) %&gt;% str_trim() %&gt;% str_squish(),
         gesetzgebungsperioden_des_nr=str_remove_all(gesetzgebungsperioden_des_nr, &quot;Gesetzgebungsperioden des NR&quot;) %&gt;% 
           str_trim() %&gt;% str_squish(),
         bundesland=str_remove_all(bundesland, &quot;Bundesland&quot;) %&gt;% str_trim() %&gt;% str_squish()) %&gt;% 
  select(-bereich)


df_all_x &lt;- df_all %&gt;% 
  left_join(., df_br,
            by=&quot;name&quot;)</code></pre>
</div>
</div>
<div id="results" class="section level1">
<h1>Results</h1>
</div>
